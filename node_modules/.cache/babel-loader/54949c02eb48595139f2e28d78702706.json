{"ast":null,"code":"var _jsxFileName = \"/home/meric/elastic/src/App.js\";\nimport React, { Component } from \"react\";\nimport './App.css';\nimport SplitterLayout from 'react-splitter-layout';\nimport 'react-splitter-layout/lib/index.css';\nimport Panel from 'muicss/lib/react/panel';\nimport DynamicForm from './components/dynamicForm/dynamicForm';\nimport myJson from './datatypes.json';\nimport txt from './datatypes.txt';\nimport txt_output from './datatypes_output.txt';\nimport json from './config/simple.json';\nimport axios from 'axios';\nimport JSONPretty from 'react-json-prettify';\nimport { github } from 'react-json-prettify/dist/themes';\nimport queryBuilder from 'elastic-builder'; //const elasticsearch = require('elastic-search');\n//const esb = require('elastic-builder');\n\nvar formJson = {\n  \"name\": \"ABCz Form\",\n  \"fields\": []\n};\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.submitHandler = event => {\n      let json = JSON.stringify(event, null, 4);\n      this.generateQuery(json); //console.log(json);\n    };\n\n    this.generateQuery = formResults => {\n      var form = JSON.parse(formResults);\n      /*\n      // Bool query\n      const requestBody = queryBuilder.requestBodySearch().query(\n        queryBuilder.boolQuery()\n          /*.must(queryBuilder.matchQuery(\"studies.DCMs.\"+form.data[0].name.replace(/ /g, '_')+\".Value\", form.data[0].value))\n          .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[1].name.replace(/ /g, '_')+\".Value\").gt(form.data[1].value).lte(form.data[2].value))\n          .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[3].name.replace(/ /g, '_')+\".Value\").gt(form.data[3].value).lte(form.data[4].value))\n          */\n      //.must(queryBuilder.matchQuery(\"studies.DCMs.\"+form.data[5].name.replace(/ /g, '_')+\".Value\", form.data[5].value))\n      //.must(queryBuilder.matchQuery(\"studies.DCMs.\"+form.data[6].name.replace(/ /g, '_')+\".Value\", form.data[6].value))\n\n      /*.filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[7].name.replace(/ /g, '_')+\".Value\").gt(form.data[7].value).lte(form.data[8].value))\n      .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[9].name.replace(/ /g, '_')+\".Value\").gt(form.data[9].value).lte(form.data[10].value))\n      .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[11].name.replace(/ /g, '_')+\".Value\").gt(form.data[11].value).lte(form.data[12].value))\n      .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[13].name.replace(/ /g, '_')+\".Value\").gt(form.data[13].value).lte(form.data[14].value))\n      .must(queryBuilder.matchQuery(\"studies.DCMs.\"+form.data[15].name.replace(/ /g, '_')+\".Value\", form.data[15].value))  \n      */\n      // Bool query\n\n      const requestBody = queryBuilder.requestBodySearch().query(queryBuilder.boolQuery().must(queryBuilder.matchQuery(\"DCMs.\" + form.data[0].name.replace(/ /g, '_') + \".Value\", form.data[0].value)).must(queryBuilder.matchQuery(\"DCMs.\" + form.data[1].name.replace(/ /g, '_') + \".Value\", form.data[1].value)).must(queryBuilder.matchQuery(\"DCMs.\" + form.data[2].name.replace(/ /g, '_') + \".Value\", form.data[2].value)).must(queryBuilder.matchQuery(\"DCMs.\" + form.data[3].name.replace(/ /g, '_') + \".Value\", form.data[3].value)).must(queryBuilder.matchQuery(\"DCMs.\" + form.data[4].name.replace(/ /g, '_') + \".Value\", form.data[4].value)));\n\n      for (var i = form.data.length - 1; i >= 0; i--) {\n        if (form.data[i].value == \"\") {\n          //console.log(i)\n          requestBody._body.query._body.bool.must.splice(i, 1); //console.log(query)\n\n        }\n      }\n\n      console.log(requestBody);\n      this.sendRequest(JSON.stringify(requestBody));\n      /*\n          requestBody.toJSON();\n      \n        \"query\": {\n          \"bool\": {\n            \"must\": {\n              \"match\": { \"last_name\": \"smith\" }\n            },\n            \"filter\": {\n              \"range\": { \"age\": { \"gt\": 30 } }\n            }\n          }\n        }\n      }\n      \n      // Multi Match Query\n      requestBody = queryBuilder.requestBodySearch().query(\n        queryBuilder.multiMatchQuery(['title', 'body'], 'Quick brown fox')\n          .type('best_fields')\n          .tieBreaker(0.3)\n          .minimumShouldMatch('30%')\n      );\n      \n      requestBody.toJSON();\n      {\n        \"multi_match\": {\n          \"query\": \"Quick brown fox\",\n          \"type\": \"best_fields\",\n          \"fields\": [\"title\", \"body\"],\n          \"tie_breaker\": 0.3,\n          \"minimum_should_match\": \"30%\"\n        }\n      }\n      \n      // Aggregation\n      requestBody = queryBuilder.requestBodySearch()\n        .size(0)\n        .agg(queryBuilder.termsAggregation('popular_colors', 'color'));\n      \n        \n      requestBody.toJSON();\n      {\n        \"size\": 0,\n        \"aggs\": {\n          \"popular_colors\": {\n            \"terms\": { \"field\": \"color\" }\n          }\n        }\n      }\n      \n      // Sort\n      requestBody = queryBuilder.requestBodySearch()\n        .query(queryBuilder.boolQuery().filter(queryBuilder.termQuery('message', 'test')))\n        .sort(queryBuilder.sort('timestamp', 'desc'))\n        .sorts([\n          queryBuilder.sort('channel', 'desc'),\n          queryBuilder.sort('categories', 'desc'),\n          // The order defaults to desc when sorting on the _score,\n          // and defaults to asc when sorting on anything else.\n          queryBuilder.sort('content'),\n          queryBuilder.sort('price').order('desc').mode('avg')\n        ]);\n      \n        \n      requestBody.toJSON();\n      {\n        \"query\": {\n          \"bool\": {\n            \"filter\": {\n              \"term\": { \"message\": \"test\" }\n            }\n          }\n        },\n        \"sort\": [\n          { \"timestamp\": { \"order\": \"desc\" } },\n          { \"channel\": { \"order\": \"desc\" } },\n          { \"categories\": { \"order\": \"desc\" } },\n          \"content\",\n          { \"price\": { \"order\": \"desc\", \"mode\": \"avg\" } }\n        ]\n      }\n      */\n    };\n\n    this.state = {\n      form: formJson,\n      response: ''\n    };\n    this.handleClick = this.handleClick.bind(this);\n  }\n\n  handleClick() {\n    axios.get().then(res => {\n      this.setState({\n        todo: res.data\n      });\n    });\n  }\n\n  sendRequest(requestBody) {\n    //console.log(\"handleclick\")\n    var panel = document.getElementById(\"resultPanel\"); //console.log(\"requestBody: \"+requestBody)\n\n    fetch('http://127.0.0.1:5000/query', {\n      method: \"POST\",\n      //Request Type \n      body: requestBody,\n      //post body \n      headers: {\n        //Header Defination \n        'Content-Type': 'application/json'\n      }\n    }).then(response => response.json()) //If response is in json then in success\n    .then(responseJson => {\n      //alert(JSON.stringify(responseJson));\n      //console.log(responseJson);\n      panel.value = responseJson;\n    }) //If response is not in json then in error \n    .catch(error => {\n      alert(JSON.stringify(error)); //console.error(error);\n    });\n  }\n\n  componentWillMount() {\n    fetch(txt_output).then(r => r.text()).then(text => {\n      let myarray = text.split('\\n');\n      let dataArray = myarray.map((element, i) => {\n        var array = element.split(' ');\n\n        if (array.length === 4) {\n          let name = array[0];\n          name = name.replace(/_/g, ' ');\n          let type = array[1];\n          let options = array[2];\n          options = options.replace(/\\)/g, '');\n          options = options.replace(/\\(/g, '');\n          let optionsArray = options.split(',');\n          var optionData = {\n            \"options\": []\n          };\n          var data = {};\n          optionsArray.map((option, i) => {\n            optionData.options.push({\n              \"display\": option\n            });\n          });\n          return {\n            \"id\": name,\n            \"label\": name,\n            \"description\": \"\",\n            \"type\": type,\n            \"value\": \"\",\n            \"required\": \"false\",\n            \"placeholder\": \"\",\n            \"definition\": optionData\n          };\n        } else if (array.length === 3) {\n          let name = array[0];\n          name = name.replace(/_/g, ' ');\n          let type = array[1];\n          return {\n            \"id\": name,\n            \"label\": name,\n            \"description\": \"\",\n            \"type\": type,\n            \"value\": \"\",\n            \"required\": \"false\",\n            \"placeholder\": \"\"\n          };\n        }\n      });\n      this.setState({\n        form: {\n          fields: dataArray\n        }\n      });\n      console.log(dataArray);\n    });\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"App\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277\n      },\n      __self: this\n    }, React.createElement(SplitterLayout, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 279\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 280\n      },\n      __self: this\n    }, \"Build a Query !\", React.createElement(DynamicForm, {\n      id: \"form\",\n      config: this.state.form,\n      onSubmit: event => this.submitHandler(event),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 281\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 286\n      },\n      __self: this\n    }, React.createElement(Panel, {\n      id: \"resultPanel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287\n      },\n      __self: this\n    }, React.createElement(JSONPretty, {\n      json: this.state.response,\n      theme: github,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287\n      },\n      __self: this\n    })))));\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/home/meric/elastic/src/App.js"],"names":["React","Component","SplitterLayout","Panel","DynamicForm","myJson","txt","txt_output","json","axios","JSONPretty","github","queryBuilder","formJson","App","constructor","props","submitHandler","event","JSON","stringify","generateQuery","formResults","form","parse","requestBody","requestBodySearch","query","boolQuery","must","matchQuery","data","name","replace","value","i","length","_body","bool","splice","console","log","sendRequest","state","response","handleClick","bind","get","then","res","setState","todo","panel","document","getElementById","fetch","method","body","headers","responseJson","catch","error","alert","componentWillMount","r","text","myarray","split","dataArray","map","element","array","type","options","optionsArray","optionData","option","push","fields","render"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport './App.css';\nimport SplitterLayout from 'react-splitter-layout';\nimport 'react-splitter-layout/lib/index.css';\nimport Panel from 'muicss/lib/react/panel';\nimport DynamicForm from './components/dynamicForm/dynamicForm';\nimport myJson from './datatypes.json';\nimport txt from './datatypes.txt';\nimport txt_output from './datatypes_output.txt';\nimport json from './config/simple.json';\nimport axios from 'axios';\nimport JSONPretty from 'react-json-prettify';\nimport { github } from 'react-json-prettify/dist/themes';\nimport queryBuilder from 'elastic-builder';\n\n//const elasticsearch = require('elastic-search');\n//const esb = require('elastic-builder');\n\n\nvar formJson = {\n  \"name\": \"ABCz Form\",\n  \"fields\": []\n};\n\nclass App extends Component {\n\n  constructor(props) {\n\n    super(props);\n    this.state = {\n\n      form: formJson,\n      response: ''\n    }\n    this.handleClick = this.handleClick.bind(this)\n  }\n\n  handleClick() {\n    axios.get()\n      .then(res => {\n        this.setState({\n          todo: res.data\n        })\n      })\n  }\n\n  sendRequest(requestBody) {\n    //console.log(\"handleclick\")\n    var panel = document.getElementById(\"resultPanel\");\n      //console.log(\"requestBody: \"+requestBody)\n      fetch('http://127.0.0.1:5000/query', {\n      method: \"POST\",//Request Type \n      body: requestBody,//post body \n      headers: {//Header Defination \n        'Content-Type': 'application/json',      },\n    })\n    .then((response) => response.json())\n    //If response is in json then in success\n    .then((responseJson) => {\n        //alert(JSON.stringify(responseJson));\n        //console.log(responseJson);\n        panel.value = responseJson;\n    })\n    //If response is not in json then in error \n    .catch((error) => {\n      alert(JSON.stringify(error));\n      //console.error(error);\n    });\n\n\n  }\n\n  submitHandler = (event) => {\n    let json = JSON.stringify(event, null, 4);\n    this.generateQuery(json);\n    //console.log(json);\n  }\n\n  generateQuery = (formResults) => {\n    var form = JSON.parse(formResults);\n\n    /*\n    // Bool query\n    const requestBody = queryBuilder.requestBodySearch().query(\n      queryBuilder.boolQuery()\n        /*.must(queryBuilder.matchQuery(\"studies.DCMs.\"+form.data[0].name.replace(/ /g, '_')+\".Value\", form.data[0].value))\n        .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[1].name.replace(/ /g, '_')+\".Value\").gt(form.data[1].value).lte(form.data[2].value))\n        .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[3].name.replace(/ /g, '_')+\".Value\").gt(form.data[3].value).lte(form.data[4].value))\n        */\n        //.must(queryBuilder.matchQuery(\"studies.DCMs.\"+form.data[5].name.replace(/ /g, '_')+\".Value\", form.data[5].value))\n        //.must(queryBuilder.matchQuery(\"studies.DCMs.\"+form.data[6].name.replace(/ /g, '_')+\".Value\", form.data[6].value))\n        /*.filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[7].name.replace(/ /g, '_')+\".Value\").gt(form.data[7].value).lte(form.data[8].value))\n        .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[9].name.replace(/ /g, '_')+\".Value\").gt(form.data[9].value).lte(form.data[10].value))\n        .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[11].name.replace(/ /g, '_')+\".Value\").gt(form.data[11].value).lte(form.data[12].value))\n        .filter(queryBuilder.rangeQuery(\"studies.DCMs.\"+form.data[13].name.replace(/ /g, '_')+\".Value\").gt(form.data[13].value).lte(form.data[14].value))\n        .must(queryBuilder.matchQuery(\"studies.DCMs.\"+form.data[15].name.replace(/ /g, '_')+\".Value\", form.data[15].value))  \n      */\n\n    // Bool query\n    const requestBody = queryBuilder.requestBodySearch().query(\n      queryBuilder.boolQuery()\n        .must(queryBuilder.matchQuery(\"DCMs.\"+form.data[0].name.replace(/ /g, '_')+\".Value\", form.data[0].value))\n        .must(queryBuilder.matchQuery(\"DCMs.\"+form.data[1].name.replace(/ /g, '_')+\".Value\", form.data[1].value))\n        .must(queryBuilder.matchQuery(\"DCMs.\"+form.data[2].name.replace(/ /g, '_')+\".Value\", form.data[2].value))\n        .must(queryBuilder.matchQuery(\"DCMs.\"+form.data[3].name.replace(/ /g, '_')+\".Value\", form.data[3].value))\n        .must(queryBuilder.matchQuery(\"DCMs.\"+form.data[4].name.replace(/ /g, '_')+\".Value\", form.data[4].value))\n    );\n        \n    for (var i = form.data.length-1; i >= 0; i--) {\n        if(form.data[i].value == \"\"){\n          //console.log(i)\n          requestBody._body.query._body.bool.must.splice(i,1);\n          //console.log(query)\n          }    \n      } \n      \n    console.log(requestBody)\n    this.sendRequest(JSON.stringify(requestBody));\n\n      \n/*\n    requestBody.toJSON();\n\n  \"query\": {\n    \"bool\": {\n      \"must\": {\n        \"match\": { \"last_name\": \"smith\" }\n      },\n      \"filter\": {\n        \"range\": { \"age\": { \"gt\": 30 } }\n      }\n    }\n  }\n}\n\n// Multi Match Query\nrequestBody = queryBuilder.requestBodySearch().query(\n  queryBuilder.multiMatchQuery(['title', 'body'], 'Quick brown fox')\n    .type('best_fields')\n    .tieBreaker(0.3)\n    .minimumShouldMatch('30%')\n);\n\nrequestBody.toJSON();\n{\n  \"multi_match\": {\n    \"query\": \"Quick brown fox\",\n    \"type\": \"best_fields\",\n    \"fields\": [\"title\", \"body\"],\n    \"tie_breaker\": 0.3,\n    \"minimum_should_match\": \"30%\"\n  }\n}\n\n// Aggregation\nrequestBody = queryBuilder.requestBodySearch()\n  .size(0)\n  .agg(queryBuilder.termsAggregation('popular_colors', 'color'));\n\n  \nrequestBody.toJSON();\n{\n  \"size\": 0,\n  \"aggs\": {\n    \"popular_colors\": {\n      \"terms\": { \"field\": \"color\" }\n    }\n  }\n}\n\n// Sort\nrequestBody = queryBuilder.requestBodySearch()\n  .query(queryBuilder.boolQuery().filter(queryBuilder.termQuery('message', 'test')))\n  .sort(queryBuilder.sort('timestamp', 'desc'))\n  .sorts([\n    queryBuilder.sort('channel', 'desc'),\n    queryBuilder.sort('categories', 'desc'),\n    // The order defaults to desc when sorting on the _score,\n    // and defaults to asc when sorting on anything else.\n    queryBuilder.sort('content'),\n    queryBuilder.sort('price').order('desc').mode('avg')\n  ]);\n\n  \nrequestBody.toJSON();\n{\n  \"query\": {\n    \"bool\": {\n      \"filter\": {\n        \"term\": { \"message\": \"test\" }\n      }\n    }\n  },\n  \"sort\": [\n    { \"timestamp\": { \"order\": \"desc\" } },\n    { \"channel\": { \"order\": \"desc\" } },\n    { \"categories\": { \"order\": \"desc\" } },\n    \"content\",\n    { \"price\": { \"order\": \"desc\", \"mode\": \"avg\" } }\n  ]\n}\n*/\n\n\n  }\n\n  componentWillMount() {\n\n    fetch(txt_output)\n      .then((r) => r.text())\n      .then(text => {\n        let myarray = text.split('\\n');\n        let dataArray = myarray.map((element, i) => {\n\n\n          var array = element.split(' ');\n\n          if (array.length === 4) {\n\n            let name = array[0];\n            name = name.replace(/_/g, ' ');\n            let type = array[1];\n            let options = array[2];\n            options = options.replace(/\\)/g, '');\n            options = options.replace(/\\(/g, '');\n            let optionsArray = options.split(',');\n\n            var optionData = { \"options\": [] };\n            var data = {};\n            optionsArray.map((option, i) => {\n              optionData.options.push({ \"display\": option });\n            })\n\n            return {\n              \"id\": name,\n              \"label\": name,\n              \"description\": \"\",\n              \"type\": type,\n              \"value\": \"\",\n              \"required\": \"false\",\n              \"placeholder\": \"\",\n              \"definition\": optionData\n            };\n\n          }\n\n          else if (array.length === 3) {\n            let name = array[0];\n            name = name.replace(/_/g, ' ');\n            let type = array[1];\n\n            return {\n              \"id\": name,\n              \"label\": name,\n              \"description\": \"\",\n              \"type\": type,\n              \"value\": \"\",\n              \"required\": \"false\",\n              \"placeholder\": \"\"\n            };\n          }\n\n        })\n\n        this.setState({\n          form: {\n            fields: dataArray\n          }\n        });\n        console.log(dataArray);\n\n      })\n  }\n\n  render() {\n    return (\n      <div className=\"App\">\n\n        <SplitterLayout>\n          <div>Build a Query !\n            <DynamicForm id=\"form\" config={this.state.form} onSubmit={(event) => this.submitHandler(event)}></DynamicForm>\n\n          </div>\n\n\n          <div>\n            <Panel id=\"resultPanel\"><JSONPretty json={this.state.response} theme={github} /></Panel>\n          </div>\n        </SplitterLayout>\n\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}